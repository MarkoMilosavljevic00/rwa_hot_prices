<p-toast></p-toast>

<form
  fxLayout="column"
  fxLayoutGap="40px"
  [formGroup]="couponForm"
  (ngSubmit)="onSubmit()"
>
  <section fxLayout="column">
    <mat-card-title>Basic Informations</mat-card-title>
    <mat-divider></mat-divider>
    <div
      fxLayout.gt-xs="row"
      fxLayout.lt-sm="column"
      fxLayoutAlign="center center"
    >
      <mat-card-subtitle fxFlex="15%">Title: </mat-card-subtitle>
      <span fxFlex>
        <mat-form-field fxFlex class="centered-field">
          <mat-label>Title</mat-label>
          <input matInput formControlName="title" />
          <mat-error
            *ngIf="
              couponForm.get('title')?.hasError('required') &&
              couponForm.get('title')?.touched
            "
            >Field must not be empty</mat-error
          >
        </mat-form-field>
      </span>
    </div>

    <div
      fxLayout.gt-xs="row"
      fxLayout.lt-sm="column"
      fxLayoutAlign="start center"
    >
      <mat-card-subtitle fxFlex="15%">Category: </mat-card-subtitle>
      <p-treeSelect
        class="centered-field"
        containerStyleClass="w-full"
        formControlName="selectedCategory"
        [options]="categoryOptions"
        placeholder="Select Category"
      ></p-treeSelect>
    </div>

    <div
      fxLayout.gt-xs="row"
      fxLayout.lt-sm="column"
      fxLayoutAlign="center center"
    >
      <mat-card-subtitle>Description: </mat-card-subtitle>
      <app-editor
        fxFlex="100%"
        [maxLength]="300"
        [height]="'150px'"
        (onContentChange)="description = $event"
        [content]="descriptionControl?.value"
      >
      </app-editor>
    </div>

    <div
      fxLayout.gt-xs="row"
      fxLayout.lt-sm="column"
      fxLayoutAlign="center center"
    >
      <mat-card-subtitle fxFlex="15%">Upload Images: </mat-card-subtitle>
      <p-fileUpload
        name="demo[]"
        url="https://www.primefaces.org/cdn/api/upload.php"
        (onUpload)="onUpload($event)"
        [multiple]="true"
        accept="image/*"
        [maxFileSize]="1000000"
        fxFlex="90%"
        fxLayoutAlign="center center"
      >
        <ng-template pTemplate="content">
          <ul *ngIf="uploadedFiles.length">
            <li *ngFor="let file of uploadedFiles">
              {{ file.name }} - {{ file.size }} bytes
            </li>
          </ul>
        </ng-template>
      </p-fileUpload>
    </div>
  </section>

  <section>
    <mat-card-title>Code Informations</mat-card-title>
    <mat-divider></mat-divider>

    <div
      fxLayout.gt-xs="row"
      fxLayout.lt-sm="column"
      fxLayoutAlign="start center"
    >
      <mat-card-subtitle fxFlex="15%"> Code Exists: </mat-card-subtitle>
      <p-selectButton
        class="centered-field"
        [options]="codeOptions"
        formControlName="codeOptionSelected"
        (onChange)="onCodeOptionChange($event.value)"
      ></p-selectButton>
    </div>

    <div
      fxLayout.gt-xs="row"
      fxLayout.lt-sm="column"
      fxLayoutAlign="start center"
    >
      <mat-card-subtitle fxFlex="15%"> Code: </mat-card-subtitle>
      <mat-form-field class="centered-field" fxFlex>
        <mat-label>Code</mat-label>
        <input matInput formControlName="code" />
      </mat-form-field>
    </div>
  </section>

  <section>
    <mat-card-title>Location Information</mat-card-title>
    <mat-divider></mat-divider>

    <div
      fxLayout.gt-xs="row"
      fxLayout.lt-sm="column"
      fxLayoutAlign="start center"
    >
      <mat-card-subtitle fxFlex="15%">Store: </mat-card-subtitle>
      <mat-form-field class="centered-field" fxFlex>
        <mat-label>Store</mat-label>
        <input matInput formControlName="store" />
      </mat-form-field>
    </div>

    <div
      fxLayout.gt-xs="row"
      fxLayout.lt-sm="column"
      fxLayoutAlign="start center"
    >
      <mat-card-subtitle fxFlex="15%"> Type of Sale: </mat-card-subtitle>
      <p-selectButton
        class="centered-field"
        [options]="saleTypeOptions"
        formControlName="saleType"
        (onChange)="onSaleTypeOptionChange($event.value)"
      ></p-selectButton>
    </div>

    <div
      fxLayout.gt-xs="row"
      fxLayout.lt-sm="column"
      fxLayoutAlign="start center"
    >
      <mat-card-subtitle fxFlex="15%"> Link: </mat-card-subtitle>
      <mat-form-field class="centered-field" fxFlex>
        <mat-label>Link</mat-label>
        <input matInput formControlName="link" />
      </mat-form-field>
    </div>
    <div
      fxLayout.gt-xs="row"
      fxLayout.lt-sm="column"
      fxLayoutAlign="start center"
    >
      <mat-card-subtitle fxFlex="15%"> Location: </mat-card-subtitle>
      <mat-form-field class="centered-field" fxFlex>
        <mat-label>Location</mat-label>
        <input matInput formControlName="location" />
      </mat-form-field>
    </div>
  </section>

  <section>
    <mat-card-title>Discount Information</mat-card-title>
    <mat-divider></mat-divider>

    <div
      fxLayout.gt-xs="row"
      fxLayout.lt-sm="column"
      fxLayoutAlign="start center"
    >
      <mat-card-subtitle fxFlex="15%"> Multiple discounts: </mat-card-subtitle>
      <p-selectButton
        class="centered-field"
        [options]="multipleDiscountOptions"
        formControlName="multipleDiscountOptionSelected"
        optionLabel="label"
        optionValue="value"
      ></p-selectButton>
    </div>

    <div
      *ngIf="multipleDiscountsControl?.value"
      fxLayout.gt-xs="row"
      fxLayout.lt-sm="column"
      fxLayoutAlign="center center"
    >
      <mat-card-subtitle fxFlex="15%">Discounts:</mat-card-subtitle>
      <div
        fxFlex="90%"
        class="centered-field"
        fxLayout="column"
        fxLayoutAlign="center center"
      >
        <div
          formArrayName="discounts"
          *ngFor="let discount of discountsFormArray.controls; index as i"
        >
          <span
            fxLayout.gt-xs="row"
            fxLayout.lt-sm="column"
            fxLayoutGap="2%"
            [formGroupName]="i"
          >
            <mat-form-field>
              <mat-label>Item</mat-label>
              <input matInput formControlName="key" />
            </mat-form-field>
            <mat-form-field fxFlex>
              <mat-label>Discount</mat-label>
              <input
                matInput
                type="number"
                placeholder="0"
                formControlName="value"
              />
              <span matTextSuffix>%</span>
            </mat-form-field>
            <button
              mat-raised-button
              [disabled]="i === discountsFormArray.controls.length - 1"
              color="warn"
              (click)="deleteDiscount(i)"
            >
              <mat-icon>delete</mat-icon>
            </button>
          </span>
        </div>
        <button
          mat-raised-button
          color="warn"
          (click)="addDiscount()"
          [disabled]="
            isLastTwoFieldsEmpty() || this.discountsFormArray.controls.length > 10
          "
        >
          Add Discount
        </button>
      </div>
    </div>

    <div
      *ngIf="!multipleDiscountsControl?.value"
      fxLayout.gt-xs="row"
      fxLayout.lt-sm="column"
      fxLayoutAlign="start center"
    >
      <mat-card-subtitle fxFlex="15%">Discount: </mat-card-subtitle>
      <mat-form-field class="centered-field" fxFlex>
        <mat-label>Discount</mat-label>
        <input
          matInput
          type="number"
          placeholder="0"
          formControlName="discount"
        />
        <span matTextSuffix>%</span>
      </mat-form-field>
    </div>
  </section>

  <section>
    <mat-card-title>Expiry Information</mat-card-title>
    <mat-divider></mat-divider>

    <div
      fxLayout.gt-xs="row"
      fxLayout.lt-sm="column"
      fxLayoutAlign="start center"
    >
      <mat-card-subtitle fxFlex="15%"> Expiry Date Exists: </mat-card-subtitle>
      <p-selectButton
        class="centered-field"
        [options]="expiryDateOptions"
        formControlName="expiryDateOptions"
        optionLabel="label"
        optionValue="value"
        (onChange)="onExpiryDateOptionChange($event.value)"
      ></p-selectButton>
    </div>

    <div
      fxLayout.gt-xs="row"
      fxLayout.lt-sm="column"
      fxLayoutAlign="start center"
    >
      <mat-card-subtitle fxFlex="15%"> Expiry Date: </mat-card-subtitle>
      <p-calendar
        class="centered-field"
        formControlName="expiryDate"
        [minDate]="minExpiryDate"
        [readonlyInput]="true"
        (onInput)="onExpiryDateChange($event)"
      ></p-calendar>
    </div>
  </section>

  <div fxFlex fxLayoutAlign="center center">
    <button
      mat-fab
      extended
      class="submit-button"
      color="warn"
      fxFlex.lt-sm="100%"
    >
      SUBMIT COUPON
    </button>
  </div>
</form>
